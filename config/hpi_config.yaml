# HPI Model Configuration 

# Data Configuration
data:
  train_dir: "HPI-NET/dataset/training/mat_norm"
  test_dir: "HPI-NET/dataset/testing/mat_norm"
  csf_path: "HPI-NET/dataset/Canon_1D_Mark_III.mat"
  train_split_ratio: 0.7
  random_seed: 42
  target_height: 132

  normalize_input: true
  preserve_aspect_ratio: true

  compute_ge2_prior: true
  compute_gw_prior: true
  ge2_order: 2
  ge2_norm: 1
  gw_norm: 1

  cache_priors: true
  preprocessing_strategy: "standard"

  augmentation:
    enable: true
    horizontal_flip: true
    brightness_range: [0.9, 1.1]
    random_crop: false
    cutout:
      enable: true
      n_holes: 2
      hole_size: 16
      probability: 0.3

# Model Configuration
model:
  type: "hierarchical_prior_injection"
  input_channels: 31
  output_dim: 31

  spectral_extractor:
    hidden_channels: [64, 128, 256]
    dropout_rate: 0.4
    inject_ge2_after_conv1: true
    inject_gw_after_conv3: true

  resnet_regressor:
    input_dim: 256
    hidden_dims: [128, 256, 128]
    num_residual_blocks: 3
    dropout_rate: 0.4
    l2_regularization: 0.0001

# Loss Configuration
loss:
  type: "angular_error"

  task_loss:
    type: "recovery_angular_error"
    use_csf: true
    epsilon: 0.000001
    use_cosine_similarity: true

  regularization:
    feature_diversity_weight: 0.0
    spectral_smoothness_weight: 0.0

# Training Configuration
training:
  batch_size: 8
  learning_rate: 0.0001
  num_epochs: 500

  optimizer: "adam"
  weight_decay: 0.0001
  adam_betas: [0.9, 0.999]
  adam_eps: 1.0e-8
  amsgrad: false

  enable_nan_protection: true
  drop_last: true
  gradient_clip_norm: 1.0

  use_scheduler: false

  early_stopping_patience: 25
  monitor_metric: "val_loss"
  early_stopping_min_delta: 0.001

# Validation / Output Configuration
validation:
  save_best_model: true
  model_save_path: "results/hpi_models"
  log_dir: "results/hpi_logs"
  evaluate_every: 1

  test_set_validation: false
  test_set_validation_interval: 50
  save_test_results: true

  metrics:
    - "recovery_angular_error"
    - "reproduction_angular_error"
    - "prior_injection_impact"

  save_predictions: true
  save_injection_info: true
  compute_statistics: true

# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  save_to_file: true
  log_file: "results/hpi_logs/training.log"
  log_gradient_norm: true
  log_every_n_steps: 10

# Device Configuration
device:
  use_cuda: true
  cuda_device: 0
  mixed_precision: false
  cudnn_benchmark: true

# Dataloader Configuration
dataloader:
  num_workers: 0
  pin_memory: true
  persistent_workers: false

